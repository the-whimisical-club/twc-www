{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/avan/github/twc-www/utils/supabase/server.ts"],"sourcesContent":["\nimport { createServerClient, type CookieOptions } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\n\nexport const createClient = async (cookieStore: ReturnType<typeof cookies>) => {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY;\n\n  if (!supabaseUrl || !supabaseKey) {\n    throw new Error('Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY');\n  }\n\n  const cookieStoreResolved = await cookieStore;\n  return createServerClient(\n    supabaseUrl,\n    supabaseKey,\n    {\n      cookies: {\n        getAll() {\n          return cookieStoreResolved.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => cookieStoreResolved.set(name, value, options))\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    },\n  );\n};\n"],"names":[],"mappings":";;;;AACA;AAAA;;AAGO,MAAM,eAAe,OAAO;IACjC,MAAM;IACN,MAAM;IAEN;;IAIA,MAAM,sBAAsB,MAAM;IAClC,OAAO,IAAA,+LAAkB,EACvB,aACA,aACA;QACE,SAAS;YACP;gBACE,OAAO,oBAAoB,MAAM;YACnC;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,oBAAoB,GAAG,CAAC,MAAM,OAAO;gBAC1F,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///Users/avan/github/twc-www/app/actions/auth.ts"],"sourcesContent":["'use server'\n\nimport { createClient } from '@/utils/supabase/server'\nimport { cookies } from 'next/headers'\nimport { redirect } from 'next/navigation'\n\nexport async function sendOTP(formData: FormData) {\n  try {\n    const email = formData.get('email') as string\n\n    if (!email) {\n      return { error: 'Email is required' }\n    }\n\n    const cookieStore = cookies()\n    const supabase = await createClient(cookieStore)\n\n    // For OTP codes instead of magic links:\n    // 1. Go to Supabase Dashboard > Authentication > Email Templates > Magic Link\n    // 2. Replace template with: <h2>One time login code</h2><p>Please enter this code: {{ .Token }}</p>\n    // 3. Save the template\n    const { error } = await supabase.auth.signInWithOtp({\n      email,\n      options: {\n        shouldCreateUser: true,\n        // Explicitly don't set emailRedirectTo - this forces OTP mode when template uses {{ .Token }}\n      },\n    })\n\n    if (error) {\n      console.error('Supabase OTP error:', error)\n      return { error: error.message }\n    }\n\n    return { success: true, email }\n  } catch (err) {\n    console.error('sendOTP error:', err)\n    return { \n      error: err instanceof Error \n        ? err.message \n        : 'Failed to send verification code. Please check your connection and try again.' \n    }\n  }\n}\n\nexport async function verifyOTP(formData: FormData) {\n  const email = formData.get('email') as string\n  const token = formData.get('code') as string\n\n  if (!email || !token) {\n    return { error: 'Email and code are required' }\n  }\n\n  const cookieStore = cookies()\n  const supabase = await createClient(cookieStore)\n\n  const { error, data } = await supabase.auth.verifyOtp({\n    email,\n    token,\n    type: 'email',\n  })\n\n  if (error) {\n    return { error: error.message }\n  }\n\n  if (data.session) {\n    // Insert email into waiting_approval table\n    // Try to insert, but don't fail if email already exists\n    const { error: insertError } = await supabase\n      .from('waiting_approval')\n      .insert({ email })\n\n    // If error is due to duplicate, that's okay - email is already in the table\n    // For other errors, log but don't block the user from logging in\n    if (insertError && insertError.code !== '23505') {\n      // 23505 is PostgreSQL unique violation error code\n      console.error('Error adding email to waiting_approval:', insertError)\n    }\n\n    redirect('/home')\n  }\n\n  return { error: 'Verification failed' }\n}\n\nexport async function signOut() {\n  const cookieStore = cookies()\n  const supabase = await createClient(cookieStore)\n  await supabase.auth.signOut()\n  redirect('/signup')\n}\n\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AACA;AAAA;;;;;;AAEO,eAAe,QAAQ,QAAkB;IAC9C,IAAI;QACF,MAAM,QAAQ,SAAS,GAAG,CAAC;QAE3B,IAAI,CAAC,OAAO;YACV,OAAO;gBAAE,OAAO;YAAoB;QACtC;QAEA,MAAM,cAAc,IAAA,0IAAO;QAC3B,MAAM,WAAW,MAAM,IAAA,2IAAY,EAAC;QAEpC,wCAAwC;QACxC,8EAA8E;QAC9E,oGAAoG;QACpG,uBAAuB;QACvB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,aAAa,CAAC;YAClD;YACA,SAAS;gBACP,kBAAkB;YAEpB;QACF;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO;gBAAE,OAAO,MAAM,OAAO;YAAC;QAChC;QAEA,OAAO;YAAE,SAAS;YAAM;QAAM;IAChC,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO;YACL,OAAO,eAAe,QAClB,IAAI,OAAO,GACX;QACN;IACF;AACF;AAEO,eAAe,UAAU,QAAkB;IAChD,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,MAAM,QAAQ,SAAS,GAAG,CAAC;IAE3B,IAAI,CAAC,SAAS,CAAC,OAAO;QACpB,OAAO;YAAE,OAAO;QAA8B;IAChD;IAEA,MAAM,cAAc,IAAA,0IAAO;IAC3B,MAAM,WAAW,MAAM,IAAA,2IAAY,EAAC;IAEpC,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS,CAAC;QACpD;QACA;QACA,MAAM;IACR;IAEA,IAAI,OAAO;QACT,OAAO;YAAE,OAAO,MAAM,OAAO;QAAC;IAChC;IAEA,IAAI,KAAK,OAAO,EAAE;QAChB,2CAA2C;QAC3C,wDAAwD;QACxD,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,oBACL,MAAM,CAAC;YAAE;QAAM;QAElB,4EAA4E;QAC5E,iEAAiE;QACjE,IAAI,eAAe,YAAY,IAAI,KAAK,SAAS;YAC/C,kDAAkD;YAClD,QAAQ,KAAK,CAAC,2CAA2C;QAC3D;QAEA,IAAA,iMAAQ,EAAC;IACX;IAEA,OAAO;QAAE,OAAO;IAAsB;AACxC;AAEO,eAAe;IACpB,MAAM,cAAc,IAAA,0IAAO;IAC3B,MAAM,WAAW,MAAM,IAAA,2IAAY,EAAC;IACpC,MAAM,SAAS,IAAI,CAAC,OAAO;IAC3B,IAAA,iMAAQ,EAAC;AACX;;;IArFsB;IAuCA;IAyCA;;AAhFA,+OAAA;AAuCA,+OAAA;AAyCA,+OAAA"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///Users/avan/github/twc-www/.next-internal/server/app/signup/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {sendOTP as '40bc2ea4d0fe28604dc50e007e4dc085a301bb7687'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}